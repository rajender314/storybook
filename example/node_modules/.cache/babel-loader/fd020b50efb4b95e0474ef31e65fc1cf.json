{"ast":null,"code":"import { getAssetUrlsFromId } from '@react-loosely-lazy/manifest';\nimport React, { useContext } from 'react';\nimport { getConfig } from '../../config';\nimport { PHASE } from '../../constants';\nimport { LazySuspenseContext } from '../../suspense';\nimport { getExport } from '../../utils';\nimport { createLoaderError } from '../errors';\nfunction load(moduleId, loader) {\n  try {\n    return getExport(loader());\n  } catch (err) {\n    throw createLoaderError(err);\n  }\n}\nexport function createComponentServer({\n  dataLazyId,\n  defer,\n  loader,\n  moduleId,\n  ssr\n}) {\n  return props => {\n    var _getAssetUrlsFromId;\n    const Resolved = ssr ? load(moduleId, loader) : null;\n    const {\n      fallback\n    } = useContext(LazySuspenseContext);\n    const {\n      crossOrigin,\n      manifest\n    } = getConfig();\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"hidden\",\n      \"data-lazy-begin\": dataLazyId\n    }), defer !== PHASE.LAZY && ((_getAssetUrlsFromId = getAssetUrlsFromId(manifest, moduleId)) == null ? void 0 : _getAssetUrlsFromId.map(url => /*#__PURE__*/React.createElement(\"link\", {\n      key: url,\n      rel: defer === PHASE.PAINT ? 'preload' : 'prefetch',\n      href: url,\n      crossOrigin: crossOrigin,\n      as: \"script\"\n    }))), Resolved ? /*#__PURE__*/React.createElement(Resolved, props) : fallback, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"hidden\",\n      \"data-lazy-end\": dataLazyId\n    }));\n  };\n}","map":{"version":3,"names":["getAssetUrlsFromId","React","useContext","getConfig","PHASE","LazySuspenseContext","getExport","createLoaderError","load","moduleId","loader","err","createComponentServer","dataLazyId","defer","ssr","props","_getAssetUrlsFromId","Resolved","fallback","crossOrigin","manifest","createElement","Fragment","type","LAZY","map","url","key","rel","PAINT","href","as"],"sources":["../../../../src/lazy/components/server.tsx"],"sourcesContent":["import { getAssetUrlsFromId } from '@react-loosely-lazy/manifest';\nimport React, { useContext } from 'react';\nimport type { ComponentProps, ComponentType } from 'react';\n\nimport { getConfig } from '../../config';\nimport { PHASE } from '../../constants';\nimport { LazySuspenseContext } from '../../suspense';\nimport { getExport } from '../../utils';\n\nimport { createLoaderError } from '../errors';\nimport { ServerLoader } from '../loader';\n\nfunction load<C>(moduleId: string, loader: ServerLoader<C>) {\n  try {\n    return getExport(loader());\n  } catch (err) {\n    throw createLoaderError(err);\n  }\n}\n\nexport function createComponentServer<C extends ComponentType<any>>({\n  dataLazyId,\n  defer,\n  loader,\n  moduleId,\n  ssr,\n}: {\n  dataLazyId: string;\n  defer: number;\n  loader: ServerLoader<C>;\n  moduleId: string;\n  ssr: boolean;\n}) {\n  return (props: ComponentProps<C>) => {\n    const Resolved = ssr ? load(moduleId, loader) : null;\n    const { fallback } = useContext(LazySuspenseContext);\n    const { crossOrigin, manifest } = getConfig();\n\n    return (\n      <>\n        <input type=\"hidden\" data-lazy-begin={dataLazyId} />\n        {defer !== PHASE.LAZY &&\n          getAssetUrlsFromId(manifest, moduleId)?.map(url => (\n            <link\n              key={url}\n              rel={defer === PHASE.PAINT ? 'preload' : 'prefetch'}\n              href={url}\n              crossOrigin={crossOrigin}\n              as=\"script\"\n            />\n          ))}\n        {Resolved ? <Resolved {...props} /> : fallback}\n        <input type=\"hidden\" data-lazy-end={dataLazyId} />\n      </>\n    );\n  };\n}\n"],"mappings":"AAAA,SAASA,kBAAT,QAAmC,8BAAnC;AACA,OAAOC,KAAP,IAAgBC,UAAhB,QAAkC,OAAlC;AAGA,SAASC,SAAT,QAA0B,cAA1B;AACA,SAASC,KAAT,QAAsB,iBAAtB;AACA,SAASC,mBAAT,QAAoC,gBAApC;AACA,SAASC,SAAT,QAA0B,aAA1B;AAEA,SAASC,iBAAT,QAAkC,WAAlC;AAGA,SAASC,IAATA,CAAiBC,QAAjB,EAAmCC,MAAnC,EAA4D;EAC1D,IAAI;IACF,OAAOJ,SAAS,CAACI,MAAM,EAAP,CAAhB;EACD,CAFD,CAEE,OAAOC,GAAP,EAAY;IACZ,MAAMJ,iBAAiB,CAACI,GAAD,CAAvB;EACD;AACF;AAED,OAAO,SAASC,qBAATA,CAA6D;EAClEC,UADkE;EAElEC,KAFkE;EAGlEJ,MAHkE;EAIlED,QAJkE;EAKlEM;AALkE,CAA7D,EAYJ;EACD,OAAQC,KAAD,IAA8B;IAAA,IAAAC,mBAAA;IACnC,MAAMC,QAAQ,GAAGH,GAAG,GAAGP,IAAI,CAACC,QAAD,EAAWC,MAAX,CAAP,GAA4B,IAAhD;IACA,MAAM;MAAES;IAAF,IAAejB,UAAU,CAACG,mBAAD,CAA/B;IACA,MAAM;MAAEe,WAAF;MAAeC;IAAf,IAA4BlB,SAAS,EAA3C;IAEA,oBACEF,KAAA,CAAAqB,aAAA,CAAArB,KAAA,CAAAsB,QAAA,qBACEtB,KAAA,CAAAqB,aAAA;MAAOE,IAAI,EAAC,QAAZ;MAAqB,mBAAiBX;IAAtC,EADF,EAEGC,KAAK,KAAKV,KAAK,CAACqB,IAAhB,MAAAR,mBAAA,GACCjB,kBAAkB,CAACqB,QAAD,EAAWZ,QAAX,CADnB,qBACCQ,mBAAA,CAAwCS,GAAxC,CAA4CC,GAAG,iBAC7C1B,KAAA,CAAAqB,aAAA;MACEM,GAAG,EAAED,GADP;MAEEE,GAAG,EAAEf,KAAK,KAAKV,KAAK,CAAC0B,KAAhB,GAAwB,SAAxB,GAAoC,UAF3C;MAGEC,IAAI,EAAEJ,GAHR;MAIEP,WAAW,EAAEA,WAJf;MAKEY,EAAE,EAAC;IALL,EADF,CADD,CAFH,EAYGd,QAAQ,gBAAGjB,KAAA,CAAAqB,aAAA,CAACJ,QAAD,EAAcF,KAAd,CAAH,GAA6BG,QAZxC,eAaElB,KAAA,CAAAqB,aAAA;MAAOE,IAAI,EAAC,QAAZ;MAAqB,iBAAeX;IAApC,EAbF,CADF;EAiBD,CAtBD;AAuBD"},"metadata":{},"sourceType":"module"}