{"ast":null,"code":"import { useContext, useMemo } from 'react';\nexport function useSubscription({\n  context,\n  load,\n  onValue\n}) {\n  const {\n    subscribe,\n    currentValue\n  } = useContext(context);\n  useMemo(() => {\n    let unsubscribe = null;\n    const check = () => {\n      const done = onValue(currentValue());\n      if (done) load();\n      if (done && unsubscribe) unsubscribe();\n      return done;\n    };\n    unsubscribe = !check() ? subscribe(check) : null; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n}","map":{"version":3,"names":["useContext","useMemo","useSubscription","context","load","onValue","subscribe","currentValue","unsubscribe","check","done"],"sources":["../../../../src/lazy/components/utils.ts"],"sourcesContent":["import { useContext, useMemo } from 'react';\nimport type { Context } from 'react';\n\nimport type { SubscriptionContextValue } from '../types';\n\ntype UseSubscriptionArgs<C> = {\n  context: Context<C>;\n  load: () => void;\n  onValue: (v: number) => boolean;\n};\n\nexport function useSubscription<C extends SubscriptionContextValue>({\n  context,\n  load,\n  onValue,\n}: UseSubscriptionArgs<C>) {\n  const { subscribe, currentValue } = useContext(context);\n  useMemo(() => {\n    let unsubscribe: (() => void) | null = null;\n    const check = () => {\n      const done = onValue(currentValue());\n      if (done) load();\n      if (done && unsubscribe) unsubscribe();\n\n      return done;\n    };\n\n    unsubscribe = !check() ? subscribe(check) : null;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n}\n"],"mappings":"AAAA,SAASA,UAAT,EAAqBC,OAArB,QAAoC,OAApC;AAWA,OAAO,SAASC,eAATA,CAA6D;EAClEC,OADkE;EAElEC,IAFkE;EAGlEC;AAHkE,CAA7D,EAIoB;EACzB,MAAM;IAAEC,SAAF;IAAaC;EAAb,IAA8BP,UAAU,CAACG,OAAD,CAA9C;EACAF,OAAO,CAAC,MAAM;IACZ,IAAIO,WAAgC,GAAG,IAAvC;IACA,MAAMC,KAAK,GAAGA,CAAA,KAAM;MAClB,MAAMC,IAAI,GAAGL,OAAO,CAACE,YAAY,EAAb,CAApB;MACA,IAAIG,IAAJ,EAAUN,IAAI;MACd,IAAIM,IAAI,IAAIF,WAAZ,EAAyBA,WAAW;MAEpC,OAAOE,IAAP;IACD,CAND;IAQAF,WAAW,GAAG,CAACC,KAAK,EAAN,GAAWH,SAAS,CAACG,KAAD,CAApB,GAA8B,IAA5C,CAVY,CAWZ;EACD,CAZM,EAYJ,EAZI,CAAP;AAaD"},"metadata":{},"sourceType":"module"}